/* Set CSS variables for borders-none mode */
/* These are applied when the plugin adds the borders-none class to body */
body.borders-none {
	--divider-width: 0px;
	--tab-outline-width: 0px;
}

body.borders-none .mod-root .workspace-tab-header-container:is(div, :hover) {
	--tab-outline-width: 0px;
}

/* ========================================
   Enhanced Workspace Borders (Default)
   ======================================== */

/* Enhanced workspace borders - minimal rounded corners on main content area only */
/* This is now the DEFAULT behavior - applies when borders-on is NOT present */
/* Based on Baseline's approach: use container-inner with margin-bottom: -1px */

/* CRITICAL: Disable default Obsidian borders by setting CSS variables to 0 */
/* This is how borders-none works - it sets these variables which Obsidian uses for borders */
/* NOTE: --divider-width might affect tab dividers - REMOVED to test if it's breaking divider logic */
body:not(.borders-on) {
	/* --divider-width: 0px; REMOVED - might be breaking tab divider logic */
	--tab-outline-width: 0px;
}

body:not(.borders-on) .mod-root .workspace-tab-header-container:is(div, :hover) {
	--tab-outline-width: 0px;
}

/* CRITICAL: Disable default borders on workspace-tab-container BEFORE applying enhanced border */
/* This prevents the double border effect */
body:not(.borders-on) .workspace .mod-root .workspace-tab-container {
	border: none !important;
	border-top: none !important;
	border-bottom: none !important;
	border-left: none !important;
	border-right: none !important;
	border-radius: 0 !important;
}

/* Now apply the enhanced border styling */
/* CRITICAL: Changed overflow: hidden to overflow: visible to prevent clipping of metadata elements */
/* Border-radius will still work - content may extend slightly beyond corners but that's acceptable */
body:not(.borders-on) .workspace .mod-root .workspace-tab-container {
	border-top: 1px solid var(--background-modifier-border) !important;
	border-left: 1px solid var(--background-modifier-border) !important;
	border-right: 1px solid var(--background-modifier-border) !important;
	border-bottom: none !important;
	border-radius: var(--radius-m) var(--radius-m) var(--radius-m) var(--radius-m) !important; /* All corners rounded */
	margin: 0;
	overflow: visible; /* Changed from hidden to prevent clipping of checkboxes, pills, etc. */
	position: relative;
	box-sizing: border-box;
}

/* Ensure child elements respect the border-radius */
body:not(.borders-on) .workspace .mod-root .workspace-tab-container > * {
	border-radius: inherit;
}

/* Compensate for borders making content narrower and shifted */
/* Use clip-path to clip content inward by 1px on all sides to account for borders */
body:not(.borders-on) .workspace .mod-root .workspace-tab-container .workspace-leaf-content,
body:not(.borders-on) .workspace .mod-root .workspace-tab-container .workspace-leaf.mod-active {
	clip-path: inset(1px);
}

/* Remove any borders from child elements and workspace-split that might create extra lines */
/* CRITICAL: Remove borders from ALL elements inside the container AND sidebars to prevent double lines */
body:not(.borders-on) .workspace .mod-root .workspace-split,
body:not(.borders-on) .workspace .mod-root .workspace-split.mod-root,
body:not(.borders-on) .workspace .mod-left-split,
body:not(.borders-on) .workspace .mod-right-split,
body:not(.borders-on) .workspace .mod-sidedock {
	border-left: none !important;
	border-right: none !important;
	border-top: none !important;
	border-bottom: none !important;
}

/* Hide workspace-ribbon border-right in Enhanced mode */
/* Obsidian's base CSS uses border-right: var(--divider-width) solid var(--divider-color) */
/* Enhanced mode should hide this border to match the clean appearance */
body:not(.borders-on) .workspace-ribbon {
	border-right: none !important;
}

/* Remove borders from workspace-leaf and workspace-leaf-content - these are likely causing the double line */
body:not(.borders-on) .workspace .mod-root .workspace-tab-container .workspace-leaf,
body:not(.borders-on) .workspace .mod-root .workspace-tab-container .workspace-leaf-content,
body:not(.borders-on) .workspace .mod-root .workspace-leaf,
body:not(.borders-on) .workspace .mod-root .workspace-leaf-content {
	border-left: none !important;
	border-right: none !important;
	border-top: none !important;
	border-bottom: none !important;
	box-shadow: none !important;
	outline: none !important;
	/* Also remove any inset box-shadows that might create border-like effects */
	box-shadow: none !important;
}

/* Hide workspace-leaf-resize-handle by default, show on hover - only for Enhanced and None modes */
/* This prevents visible lines while still allowing sidebar resizing */
/* Mimic Default mode's behavior: invisible by default, accent color on hover */
/* Target it in all possible locations */
body:not(.borders-on) .workspace-leaf-resize-handle,
body:not(.borders-on) .workspace .workspace-leaf-resize-handle,
body:not(.borders-on) .workspace .mod-root .workspace-leaf-resize-handle,
body:not(.borders-on) .workspace .mod-root .workspace-tab-container .workspace-leaf-resize-handle,
body:not(.borders-on) hr.workspace-leaf-resize-handle {
	opacity: 0 !important;
	border: none !important;
	background: none !important;
	transition: opacity 0.2s ease, background-color 0.2s ease !important;
}

/* Show resize handle on hover with accent color - matches Default mode behavior */
body:not(.borders-on) .workspace-leaf-resize-handle:hover,
body:not(.borders-on) .workspace .workspace-leaf-resize-handle:hover,
body:not(.borders-on) .workspace .mod-root .workspace-leaf-resize-handle:hover,
body:not(.borders-on) .workspace .mod-root .workspace-tab-container .workspace-leaf-resize-handle:hover,
body:not(.borders-on) hr.workspace-leaf-resize-handle:hover,
body:not(.borders-on) .workspace-leaf:hover .workspace-leaf-resize-handle,
body:not(.borders-on) .workspace .workspace-leaf:hover .workspace-leaf-resize-handle {
	opacity: 1 !important;
	background-color: var(--interactive-accent) !important;
}

/* macOS-specific fixes: Remove top border */
/* On macOS frameless windows, the title bar is integrated into the tab area, so we can't have a top border */
/* The title bar is absolutely positioned relative to workspace, not this container */
/* Keep rounded corners on all sides for visual consistency */
/* CRITICAL: Changed overflow to visible to prevent clipping (border-radius still works) */
body:not(.borders-on).mod-macos .workspace .mod-root .workspace-tab-container {
	overflow: visible !important; /* Changed from hidden to prevent clipping */
	border-top: none !important; /* Remove top border to preserve title bar integration */
	border-radius: var(--radius-m) var(--radius-m) var(--radius-m) var(--radius-m) !important; /* Round all corners */
	position: relative !important; /* Keep relative for proper rendering, title bar is positioned relative to workspace */
}

/* Ensure title bar itself is never affected by enhanced borders on macOS */
body:not(.borders-on).mod-macos.is-hidden-frameless .titlebar,
body:not(.borders-on).mod-macos.is-hidden-frameless .titlebar-inner,
body:not(.borders-on).mod-macos.is-hidden-frameless .titlebar-text {
	position: absolute !important; /* Preserve title bar positioning */
	z-index: 9999 !important; /* Ensure title bar is always on top */
	pointer-events: none !important; /* Allow clicks to pass through to window controls */
}

body:not(.borders-on).mod-macos.is-hidden-frameless .titlebar-button-container {
	pointer-events: auto !important; /* Re-enable clicks on window controls */
	z-index: 10000 !important; /* Window controls above title text */
}

/* Fix right sidebar toggle button background color on macOS when enhanced borders are enabled */
/* Override the tab-container-background that's incorrectly applied to the toggle button */
body:not(.borders-on).mod-macos.is-hidden-frameless:not(.is-popout-window) .sidebar-toggle-button.mod-right {
	background-color: var(--background-secondary) !important; /* Match sidebar background instead of tab container */
}

/* Match the left sidebar background color behind the tabs */
/* Set a CSS variable at workspace level to capture --background-secondary before any overrides */
/* Only apply when borders-on is NOT present */
body:not(.borders-on) .workspace {
	--enhanced-border-sidebar-bg: var(--background-secondary);
}

/* Apply the background to main content tab header container (always, not just when right sidebar is open) */
/* Don't apply when colorful-frame is active - let the theme handle it */
/* Add border-radius to match the active tab's rounded corners for seamless appearance */
/* Override the theme's --tab-container-background variable chain (which goes to --titlebar-background -> --bg1) */
/* We want it to use --background-secondary (bg2) instead, matching the sidebar */
/* Apply to both main content and right sidebar */
/* Only apply when borders-on is NOT present */
body:not(.borders-on):not(.colorful-frame) .workspace .mod-root .workspace-tabs.mod-top,
body:not(.borders-on):not(.colorful-frame) .workspace .mod-sidedock.mod-right-split .workspace-tabs.mod-top {
	--tab-container-background: var(--enhanced-border-sidebar-bg) !important;
}

body:not(.borders-on):not(.colorful-frame) .workspace .mod-root .workspace-tab-header-container,
body:not(.borders-on):not(.colorful-frame) .workspace .mod-sidedock.mod-right-split .workspace-tab-header-container {
	background-color: var(--enhanced-border-sidebar-bg) !important;
}

body:not(.borders-on):not(.colorful-frame) .workspace .mod-root .workspace-tab-header-container {
	border-top-left-radius: var(--radius-m);
	border-top-right-radius: var(--radius-m);
}

/* macOS-specific: Apply background color but keep top corners flat to preserve title bar integration */
/* The title bar is absolutely positioned within this area, so we must not interfere with positioning */
body:not(.borders-on):not(.colorful-frame).mod-macos.is-hidden-frameless .workspace .mod-root .workspace-tabs.mod-top {
	--tab-container-background: var(--enhanced-border-sidebar-bg) !important; /* Match sidebar background */
}

body:not(.borders-on):not(.colorful-frame).mod-macos.is-hidden-frameless .workspace .mod-root .workspace-tab-header-container {
	background-color: var(--enhanced-border-sidebar-bg) !important; /* Match sidebar background */
	border-top-left-radius: 0 !important; /* Keep top flat for title bar */
	border-top-right-radius: 0 !important; /* Keep top flat for title bar */
	position: static !important; /* Ensure title bar can position correctly */
	z-index: auto !important; /* Don't interfere with title bar z-index */
}

/* Override the workspace-split.mod-root background to match sidebar color */
/* The theme sets it to --background-primary, but we want --background-secondary for seamless appearance */
body:not(.borders-on):not(.colorful-frame) .workspace .workspace-split.mod-root {
	background-color: var(--enhanced-border-sidebar-bg) !important;
}

/* macOS-specific: Match workspace split background to sidebar to prevent bleed-through at rounded corners */
body:not(.borders-on):not(.colorful-frame).mod-macos.is-hidden-frameless .workspace .workspace-split.mod-root {
	background-color: var(--enhanced-border-sidebar-bg) !important; /* Match sidebar to prevent corner bleed */
}

/* Override the theme rule that makes right sidebar use --background-primary */
/* When enhanced borders are active, make right sidebar match left sidebar color */
/* The theme rule is: body:not(.sidebar-color) .mod-right-split { --background-secondary: var(--background-primary); } */
/* Capture the original --background-secondary at workspace level before the override applies */
body:not(.borders-on):not(.sidebar-color) .workspace {
	--enhanced-border-right-sidebar-bg: var(--background-secondary);
}

/* Override the theme's override to restore the original --background-secondary value */
body:not(.borders-on):not(.sidebar-color) .mod-right-split {
	--background-secondary: var(--enhanced-border-right-sidebar-bg) !important;
}

/* ========================================
   Tab Positioning and Styling (Group 5)
   ======================================== */

/* Use container-inner to overlap the container's top border */
/* Only apply when borders-on is NOT present AND borders-none is NOT present (Enhanced mode only) */
/* The margin-bottom: -2px moves the container up to overlap the border and close any gap */
/* NOTE: Also check for borders-none to match plugin's behavior and prevent shifts when plugin is toggled */
body:not(.borders-on):not(.borders-none) .workspace .mod-root .workspace-tab-header-container-inner {
	margin-bottom: -2px; /* Increased from -1px to ensure no gap */
	position: relative;
	z-index: 1;
}

/* macOS-specific: match the default spacing */
body:not(.borders-on):not(.borders-none).mod-macos .workspace .mod-root .workspace-tab-header-container-inner {
	margin-bottom: 0 !important;
	position: static !important;
	z-index: auto !important;
}

/* Apply vertical positioning to icon and close button only (not title) to prevent shifting */
/* This ensures icons and close buttons are positioned consistently without affecting title */
/* Use margin-top instead of transform to avoid interfering with Obsidian's divider logic */
body:not(.borders-on):not(.borders-none) .workspace .mod-root .workspace-tab-header .workspace-tab-header-inner-icon,
body:not(.borders-on):not(.borders-none) .workspace .mod-root .workspace-tab-header .workspace-tab-header-inner-close-button {
	margin-top: -1px; /* Shift icon and close button up by 1px for consistent alignment */
}

/* Restore default tab header padding */
body:not(.borders-on):not(.borders-none) .tabs-modern .mod-root .workspace-tabs:not(.mod-stacked) .workspace-tab-header-container-inner {
	padding-top: 2px !important; /* Default tabs-modern padding */
}

/* Adjust tab height to make tabs shorter (unstretched) */
body:not(.borders-on):not(.borders-none) .tabs-modern .mod-root .workspace-tabs:not(.mod-stacked) {
	--tab-height: calc(var(--header-height) - 15px); /* Reduced from 14px to 15px to make tabs 1px shorter */
}

/* TAB BORDERS ONLY - Isolated to just tab treatment */
/* Set --tab-curve on all tabs to control bottom corner curvature */
/* Only apply when borders-on is NOT present AND borders-none is NOT present (Enhanced mode only) */
/* NOTE: Also check for borders-none to match plugin's behavior and prevent shifts when plugin is toggled */
body:not(.borders-on):not(.borders-none) .workspace .mod-root .workspace-tab-header {
	--tab-curve: 8px !important; /* Increase curve amount for more pronounced bottom corners */
	margin-bottom: 0;
}

/* Inactive tabs: ensure borders are transparent in Enhanced mode */
/* Only the active tab should have visible left/right borders */
body:not(.borders-on):not(.borders-none) .workspace .mod-root .workspace-tab-header:not(.is-active) {
	border-left-color: transparent !important;
	border-right-color: transparent !important;
	border-left-width: 0 !important;
	border-right-width: 0 !important;
	--tab-outline-width: 0px !important;
	--tab-outline-color: transparent !important;
}

/* Disable box-shadow borders on inactive tabs' ::before and ::after pseudo-elements */
/* BUT don't touch workspace-tab-header-inner::after - that's Obsidian's divider */
body:not(.borders-on):not(.borders-none) .workspace .mod-root .workspace-tab-header:not(.is-active)::before,
body:not(.borders-on):not(.borders-none) .workspace .mod-root .workspace-tab-header:not(.is-active)::after {
	box-shadow: none !important;
}
/* Note: We're NOT touching workspace-tab-header-inner::after - let Obsidian handle dividers */

/* Active tab: visible border on left/right, extend down to cover container's top border */
/* Set tab outline variables ONLY for active tabs (for curved corners) */
/* Only apply when borders-on is NOT present AND borders-none is NOT present (Enhanced mode only) */
/* NOTE: Also check for borders-none to match plugin's behavior and prevent shifts when plugin is toggled */
body:not(.borders-on):not(.borders-none) .workspace .mod-root .workspace-tab-header.is-active {
	border-left-color: var(--background-modifier-border);
	border-right-color: var(--background-modifier-border);
	--tab-outline-width: 1px;
	--tab-outline-color: var(--background-modifier-border);
}

/* Let Obsidian handle default box-shadow - don't override */

/* Adjust tab curve clip-paths to align with container border */
/* Move everything up by 1px while keeping the 50% values */
/* This makes the curves connect properly, even if slightly less smooth */
body:not(.borders-on):not(.borders-none) .workspace-tab-header-container .workspace-tab-header::after {
	right: calc(var(--tab-curve) * -2);
	clip-path: inset(calc(50% - 1px) 70% 0 calc(var(--tab-curve) * -1));
}

body:not(.borders-on):not(.borders-none) .workspace-tab-header-container .workspace-tab-header::before {
	left: calc(var(--tab-curve) * -2);
	clip-path: inset(calc(50% - 1px) calc(var(--tab-curve) * -1) 0 70%);
}

/* Make sure the tab header container doesn't interfere and allows proper positioning */
/* Note: background-color is set above to match left sidebar, so we only set margin here */
/* Only apply when borders-on is NOT present AND borders-none is NOT present (Enhanced mode only) */
/* NOTE: Also check for borders-none to match plugin's behavior and prevent shifts when plugin is toggled */
body:not(.borders-on):not(.borders-none) .workspace .mod-root .workspace-tab-header-container {
	margin-bottom: 0;
}