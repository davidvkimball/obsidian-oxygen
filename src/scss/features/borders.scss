.borders-none {
	--divider-width:0px;
	--tab-outline-width: 0px;
}
body:is(.borders-none) .mod-root .workspace-tab-header-container:is(div, :hover){
	--tab-outline-width: 0px;
}

/* ========================================
   Enhanced Workspace Borders (Default)
   ======================================== */

/* Enhanced workspace borders - minimal rounded corners on main content area only */
/* This is now the DEFAULT behavior - applies when borders-on is NOT present */
/* Based on Baseline's approach: use container-inner with margin-bottom: -1px */

/* CRITICAL: Disable default Obsidian borders by setting CSS variables to 0 */
/* This is how borders-none works - it sets these variables which Obsidian uses for borders */
body:not(.borders-on) {
	--divider-width: 0px;
	--tab-outline-width: 0px;
}

body:not(.borders-on) .mod-root .workspace-tab-header-container:is(div, :hover) {
	--tab-outline-width: 0px;
}

/* CRITICAL: Disable default borders on workspace-tab-container BEFORE applying enhanced border */
/* This prevents the double border effect */
body:not(.borders-on) .workspace .mod-root .workspace-tab-container {
	border: none !important;
	border-top: none !important;
	border-bottom: none !important;
	border-left: none !important;
	border-right: none !important;
	border-radius: 0 !important;
}

/* Now apply the enhanced border styling */
body:not(.borders-on) .workspace .mod-root .workspace-tab-container {
	border: 1px solid var(--background-modifier-border) !important;
	border-top: 1px solid var(--background-modifier-border) !important;
	border-left: 1px solid var(--background-modifier-border) !important;
	border-right: 1px solid var(--background-modifier-border) !important;
	border-bottom: none !important;
	border-radius: var(--radius-m) var(--radius-m) var(--radius-m) var(--radius-m) !important; /* All corners rounded */
	margin: 0;
	overflow: hidden;
	position: relative;
	box-sizing: border-box;
}

/* macOS-specific fixes: Remove top border but keep overflow hidden for proper border-radius rendering */
/* On macOS frameless windows, the title bar is integrated into the tab area, so we can't have a top border */
/* The title bar is absolutely positioned relative to workspace, not this container, so overflow: hidden is safe */
/* Keep rounded corners on all sides for visual consistency */
body:not(.borders-on).mod-macos .workspace .mod-root .workspace-tab-container {
	overflow: hidden !important; /* Required for border-radius to render properly */
	border-top: none !important; /* Remove top border to preserve title bar integration */
	border-radius: var(--radius-m) var(--radius-m) var(--radius-m) var(--radius-m) !important; /* Round all corners */
	position: relative !important; /* Keep relative for proper rendering, title bar is positioned relative to workspace */
}

/* Match the left sidebar background color behind the tabs */
/* Set a CSS variable at workspace level to capture --background-secondary before any overrides */
/* Only apply when borders-on is NOT present */
body:not(.borders-on) .workspace {
	--enhanced-border-sidebar-bg: var(--background-secondary);
}

/* Apply the background to main content tab header container (always, not just when right sidebar is open) */
/* Don't apply when colorful-frame is active - let the theme handle it */
/* Add border-radius to match the active tab's rounded corners for seamless appearance */
/* Override the theme's --tab-container-background variable chain (which goes to --titlebar-background -> --bg1) */
/* We want it to use --background-secondary (bg2) instead, matching the sidebar */
/* Apply to both main content and right sidebar */
/* Only apply when borders-on is NOT present */
body:not(.borders-on):not(.colorful-frame) .workspace .mod-root .workspace-tabs.mod-top,
body:not(.borders-on):not(.colorful-frame) .workspace .mod-sidedock.mod-right-split .workspace-tabs.mod-top {
	--tab-container-background: var(--enhanced-border-sidebar-bg) !important;
}

body:not(.borders-on):not(.colorful-frame) .workspace .mod-root .workspace-tab-header-container,
body:not(.borders-on):not(.colorful-frame) .workspace .mod-sidedock.mod-right-split .workspace-tab-header-container {
	background-color: var(--enhanced-border-sidebar-bg) !important;
}

body:not(.borders-on):not(.colorful-frame) .workspace .mod-root .workspace-tab-header-container {
	border-top-left-radius: var(--radius-m);
	border-top-right-radius: var(--radius-m);
}

/* macOS-specific: Apply background color but keep top corners flat to preserve title bar integration */
/* The title bar is absolutely positioned within this area, so we must not interfere with positioning */
body:not(.borders-on):not(.colorful-frame).mod-macos.is-hidden-frameless .workspace .mod-root .workspace-tabs.mod-top {
	--tab-container-background: var(--enhanced-border-sidebar-bg) !important; /* Match sidebar background */
}

body:not(.borders-on):not(.colorful-frame).mod-macos.is-hidden-frameless .workspace .mod-root .workspace-tab-header-container {
	background-color: var(--enhanced-border-sidebar-bg) !important; /* Match sidebar background */
	border-top-left-radius: 0 !important; /* Keep top flat for title bar */
	border-top-right-radius: 0 !important; /* Keep top flat for title bar */
	position: static !important; /* Ensure title bar can position correctly */
	z-index: auto !important; /* Don't interfere with title bar z-index */
}

/* Ensure title bar itself is never affected by enhanced borders on macOS */
body:not(.borders-on).mod-macos.is-hidden-frameless .titlebar,
body:not(.borders-on).mod-macos.is-hidden-frameless .titlebar-inner,
body:not(.borders-on).mod-macos.is-hidden-frameless .titlebar-text {
	position: absolute !important; /* Preserve title bar positioning */
	z-index: 9999 !important; /* Ensure title bar is always on top */
	pointer-events: none !important; /* Allow clicks to pass through to window controls */
}

body:not(.borders-on).mod-macos.is-hidden-frameless .titlebar-button-container {
	pointer-events: auto !important; /* Re-enable clicks on window controls */
	z-index: 10000 !important; /* Window controls above title text */
}

/* Fix right sidebar toggle button background color on macOS when enhanced borders are enabled */
/* Override the tab-container-background that's incorrectly applied to the toggle button */
body:not(.borders-on).mod-macos.is-hidden-frameless:not(.is-popout-window) .sidebar-toggle-button.mod-right {
	background-color: var(--background-secondary) !important; /* Match sidebar background instead of tab container */
}

/* Override the workspace-split.mod-root background to match sidebar color */
/* The theme sets it to --background-primary, but we want --background-secondary for seamless appearance */
body:not(.borders-on):not(.colorful-frame) .workspace .workspace-split.mod-root {
	background-color: var(--enhanced-border-sidebar-bg) !important;
}

/* macOS-specific: Match workspace split background to sidebar to prevent bleed-through at rounded corners */
body:not(.borders-on):not(.colorful-frame).mod-macos.is-hidden-frameless .workspace .workspace-split.mod-root {
	background-color: var(--enhanced-border-sidebar-bg) !important; /* Match sidebar to prevent corner bleed */
}

/* Override the theme rule that makes right sidebar use --background-primary */
/* When enhanced borders are active, make right sidebar match left sidebar color */
/* The theme rule is: body:not(.sidebar-color) .mod-right-split { --background-secondary: var(--background-primary); } */
/* Capture the original --background-secondary at workspace level before the override applies */
body:not(.borders-on):not(.sidebar-color) .workspace {
	--enhanced-border-right-sidebar-bg: var(--background-secondary);
}

/* Override the theme's override to restore the original --background-secondary value */
body:not(.borders-on):not(.sidebar-color) .mod-right-split {
	--background-secondary: var(--enhanced-border-right-sidebar-bg) !important;
}

/* Use container-inner to overlap the container's top border */
/* Only apply when borders-on is NOT present */
/* The margin-bottom: -1px moves the container up to overlap the border */
/* Add top: -1px to move the entire tab container up by 1px to compensate for border visual effect */
body:not(.borders-on) .workspace .mod-root .workspace-tab-header-container-inner {
	margin-bottom: -1px;
	position: relative;
	z-index: 1;
}

/* macOS-specific: Adjust positioning to cover the border line but preserve title bar integration */
body:not(.borders-on).mod-macos .workspace .mod-root .workspace-tab-header-container-inner {
	margin-bottom: -1px !important; /* Move container up to cover border line */
	position: relative !important; /* Need relative for z-index to work */
	z-index: 1 !important; /* Ensure tabs are above border */
}

/* Compensate for margin-bottom: -1px by adjusting padding-top */
/* Must have higher specificity than tabs-modern rule to override its padding */
body:not(.borders-on) .tabs-modern .mod-root .workspace-tabs:not(.mod-stacked) .workspace-tab-header-container-inner {
	padding-top: 3px !important; /* Override tabs-modern's 2px padding-top */
}

/* Adjust tab height to match Minimal - reduce by 1px if tabs appear taller */
body:not(.borders-on) .tabs-modern .mod-root .workspace-tabs:not(.mod-stacked) {
	--tab-height: calc(var(--header-height) - 15px); /* Reduced from 14px to 15px to make tabs 1px shorter */
}

/* TAB BORDERS ONLY - Isolated to just tab treatment */
/* Set --tab-curve on all tabs to control bottom corner curvature */
/* Only apply when borders-on is NOT present */
body:not(.borders-on) .workspace .mod-root .workspace-tab-header {
	--tab-curve: 8px !important; /* Increase curve amount for more pronounced bottom corners */
	margin-bottom: -1px; /* Apply to ALL tabs for consistent vertical positioning */
}

/* Active tab: visible border on left/right, extend down to cover container's top border */
/* Set tab outline variables ONLY for active tabs (for curved corners) */
/* Only apply when borders-on is NOT present */
body:not(.borders-on) .workspace .mod-root .workspace-tab-header.is-active {
	border-left-color: var(--background-modifier-border);
	border-right-color: var(--background-modifier-border);
	/* margin-bottom: -1px; removed - now inherited from parent rule for consistent positioning */
	position: relative;
	--tab-outline-width: 1px;
	--tab-outline-color: var(--background-modifier-border);
}

/* Enhance ::before/::after to extend the border down to cover container's top border */
/* Obsidian's box-shadow already includes the border on the curve via --tab-outline-width */
/* We just need to extend it down to cover the container border */
/* Only apply when borders-on is NOT present */
body:not(.borders-on) .workspace .mod-root .workspace-tab-header.is-active::before,
body:not(.borders-on) .workspace .mod-root .workspace-tab-header.is-active::after {
	/* Preserve Obsidian's existing box-shadow (includes border via --tab-outline-width) */
	/* Then add extended border layers that continue down to cover container */
	box-shadow: inset 0 0 0 var(--tab-outline-width) var(--tab-outline-color), 
	            0 0 0 calc(var(--tab-curve) * 4) var(--tab-background-active),
	            0 calc(var(--tab-curve) * 2) 0 var(--tab-outline-width) var(--tab-outline-color),
	            0 calc(var(--tab-curve) * 2 + 1px) 0 var(--tab-outline-width) var(--tab-outline-color),
	            0 calc(var(--tab-curve) * 2 + 2px) 0 var(--tab-outline-width) var(--tab-outline-color);
}

/* Extend the active tab's background down to cover the container's top border */
/* Use the inner element since tab's ::after is used by Obsidian for right curve */
/* Only apply when borders-on is NOT present */
body:not(.borders-on) .workspace .mod-root .workspace-tab-header.is-active .workspace-tab-header-inner {
	position: relative;
}

/* Create extension to cover container border - use inner's ::after */
/* Hide Obsidian's divider first, then add our extension */
body:not(.borders-on) .workspace .mod-root .workspace-tab-header.is-active .workspace-tab-header-inner::after {
	content: '';
	position: absolute;
	bottom: -2px;
	left: -1px;
	right: -1px;
	height: 2px;
	background-color: var(--tab-background-active);
	z-index: 1;
	/* This extends below the curved corners to cover the container border */
	/* Note: This replaces Obsidian's divider line on the active tab */
}

/* macOS-specific: Ensure the extension properly covers the border line */
body:not(.borders-on).mod-macos .workspace .mod-root .workspace-tab-header.is-active .workspace-tab-header-inner::after {
	height: 3px !important; /* Slightly taller to ensure full coverage */
	bottom: -3px !important; /* Extend further down to cover border */
}

/* Make sure the tab header container doesn't interfere and allows proper positioning */
/* Note: background-color is set above to match left sidebar, so we only set margin here */
/* Only apply when borders-on is NOT present */
body:not(.borders-on) .workspace .mod-root .workspace-tab-header-container {
	margin-bottom: 0;
}

/* Disable enhanced borders when borders-on is explicitly set (restore original border behavior) */
body.borders-on .workspace .mod-root .workspace-tab-container {
	border: none !important;
	border-radius: 0 !important;
}

body.borders-on .workspace .mod-root .workspace-tab-header {
	border: none !important;
}